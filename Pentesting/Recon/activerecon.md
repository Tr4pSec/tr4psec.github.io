# Active Recon

## While scanning, Run a sniffer
### Tcpdump (WinDump on Windows)

tcpdump
Sudo tcpdump -n -I eth0 
Tcpdump -nnX tcp and dst 10.10.10.10

sudo tcpdump -i tap0 -nn host 10.10.10.50

-n (host IP address and port numbers instead of name)
-I int (sniff on a particular interface
-w (write to file)

## Masscan
https://github.com/robertdavidgraham/masscan

Masscan -p0-65535 --rate 15000 -oB myscan.mass 10.0.0.0/8

-oB  (binary format)

sudo masscan --ports 0-65535 --rate 15000 --src-port=55555 -oB local.masscan 127.0.0.1

## nmap

### Port Scanning
Sudo nmap -n -sT -sV -O -p 0- 10.10.10.1
-n (no dns)
-sT (TCP connect scan, 3 way handshake)
-sV (version scan)
-O (os scan)
-p (ports)

sudo nmap -n -sT 10.10.10.50 -p 21-25,80,135
-p and comma seperated to scan ranges of ports
-p also to specify a single port

sudo nmap -n -p 0- -sT 10.10.10.50
-n (don’t resolve DNS)
-p 0- (scan all ports, including 0)
-p - (scan all ports, excluding 0)
-sT (TCP connect scan, complete 3 way handshake)

-sC (default scripts)
--script=all
-iL filename (import list of hosts)
-oA basename (output to all formats)
-sP (probing to see if up or not)
-Pn (don’t probe and assume hosts are up)
-PS/PA/PU/PY[portlist]: TCP SYN/ACK, UDP or SCTP discovery to given ports
-sT (TCP connect scan, complete 3way handshake)
-n (No DNS resolution)
           Tells Nmap to never do reverse DNS
-sU (UDP scan)
--open (only show open ports)
--reason
-sV (version scanning)

### Host Discovery Scan

sudo nmap -n -sP 10.10.10.1-255 --packet-trace

The -n means that Nmap should not resolve domain names. The -sP means do a ping sweep, but watch what happens ... no ICMP (or TCP packets for that matter) will be sent for the ping sweep. Also, the --packet-trace option tells Nmap to display a summary of each packet before it sends it. While it runs, pressing Shift-p turns this off, whereas pressing the p key toggles it back on.

nmap -PS80,443,8080 -p 80,8080,443 10.10.10.0/24
-PS (host discovery based on these ports)

### OS Fingerprinting

Nmap attempts to guess the OS
-A (os fingerprinting++)
-O (os fingerprinting)
-sC (default scripts)

TTL could be an indicator less than 65 is linux

### Nmap SCRIPTS

gedit /usr/share/nmap/scripts/script.db

cd /usr/share/nmap/scripts

grep safe script.db | wc -l
329
grep discovery script.db | wc -l
296
grep intrusive script.db | wc -l
207

ls /usr/share/nmap/scripts/smb*.nse

nmap -n --script=smb-enum-users -p 139 10.10.10.10

nmap -n --script=nbstat 10.10.10.10

nmap -n --script=http-robots.txt 10.10.10.60 -p 80